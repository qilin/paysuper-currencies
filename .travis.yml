language: go
sudo: false

dist: trusty

stages:
  - test
  - name: deploy
    if: branch = develop AND type = push

jobs:
  include:
    - stage: test
      services:
        - mongodb
      go:
        - 1.13.x
      env:
        - GO111MODULE=on
        - MONGO_DSN=mongodb://127.0.0.1:27017/currency_rates_test
        - CENTRIFUGO_SECRET=some-key
      cache:
        directories:
          - $GOPATH/pkg/mod        
      install: true
      script:
        - go test ./... -coverprofile=coverage.out -covermode=atomic -p=1
        #- sonar-scanner
      after_success:
        - bash <(curl -s https://codecov.io/bash)
